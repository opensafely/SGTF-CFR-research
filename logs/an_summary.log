-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /workspace/logs/an_summary.log
  log type:  text
 opened on:  13 Feb 2021, 17:30:15

. 
. clear

. 
. /*
> use "C:\Users\EIDEDGRI\Documents\GitHub\SGTF-CFR-research\output\cr_analysis_
> dataset.dta"
> */
. 
. use ./output/cr_analysis_dataset.dta
(SGTF CFR ANALYSIS DATASET: 13 Feb 2021)

. 
. * DROP IF NO DATA ON SGTF
. noi di "DROPPING NO SGTF DATA" 
DROPPING NO SGTF DATA

. drop if has_sgtf==0
(37,035 observations deleted)

. 
. 
. * Tabulate number of deaths by SGTF and covariates
. 
. foreach var of varlist agegroup agegroupA male imd eth5 eth2 smoke_nomiss smo
> ke_nomiss2 ///
>                         obese4cat hh_total_cat stp region rural_urban5 comorb
> _cat start_week {
  2.                         
.                         noi disp "Table `var'"
  3.                         table `var' sgtf, contents(count patient_id sum ri
> sk_28 mean risk_28 sum cox_death)     
  4.                         }
Table agegroup

------------------------------
Grouped   |  SGTF (exposure)  
age       |  non-VOC       VOC
----------+-------------------
    0-<18 |   15,943    15,803
          |      233       254
          | .0146146  .0160729
          |      387       420
          | 
   18-<30 |   11,503    11,522
          |      162       155
          | .0140833  .0134525
          |      282       259
          | 
   30-<40 |    9,783     9,902
          |      152       140
          | .0155372  .0141386
          |      228       230
          | 
   40-<50 |    9,442     9,525
          |      146       146
          | .0154628  .0153281
          |      232       247
          | 
   50-<60 |   10,047     9,983
          |      157       161
          | .0156266  .0161274
          |      241       269
          | 
   60-<70 |    7,829     7,878
          |      130       103
          | .0166049  .0130744
          |      199       192
          | 
   70-<80 |    6,059     6,245
          |       84        87
          | .0138637  .0139311
          |      137       135
          | 
      80+ |    3,682     3,663
          |       59        53
          | .0160239   .014469
          |       87        88
------------------------------
Table agegroupA

------------------------------
Age       |  SGTF (exposure)  
subgroups |  non-VOC       VOC
----------+-------------------
    0-<65 |   60,859    60,868
          |      918       907
          |  .015084  .0149011
          |     1468      1517
          | 
   65-<75 |    7,344     7,447
          |      102       100
          | .0138889  .0134282
          |      177       181
          | 
   75-<85 |    4,287     4,396
          |       70        62
          | .0163284  .0141037
          |      103        98
          | 
      85+ |    1,798     1,810
          |       33        30
          | .0183537  .0165746
          |       45        44
------------------------------
Table male

------------------------------
          |  SGTF (exposure)  
     Male |  non-VOC       VOC
----------+-------------------
        F |   38,003    38,000
          |      564       565
          | .0148409  .0148684
          |      924       941
          | 
        M |   36,285    36,521
          |      559       534
          | .0154058  .0146217
          |      869       899
------------------------------
Table imd

-------------------------------------
Index of         |
Multiple         |
Deprivation      |  SGTF (exposure)  
(IMD)            |  non-VOC       VOC
-----------------+-------------------
1 least deprived |   22,138    22,462
                 |      329       354
                 | .0148613    .01576
                 |      505       597
                 | 
               2 |   14,859    14,696
                 |      225       236
                 | .0151423  .0160588
                 |      360       388
                 | 
               3 |   14,943    14,997
                 |      204       176
                 | .0136519  .0117357
                 |      352       322
                 | 
               4 |   14,820    14,967
                 |      242       221
                 | .0163293  .0147658
                 |      384       362
                 | 
 5 most deprived |    7,528     7,399
                 |      123       112
                 |  .016339  .0151372
                 |      192       171
-------------------------------------
Table eth5

--------------------------------
Ethnicity   |
in 5        |  SGTF (exposure)  
categories  |  non-VOC       VOC
------------+-------------------
      White |   41,662    41,855
            |      647       625
            | .0155297  .0149325
            |     1018      1039
            | 
South Asian |    2,807     2,744
            |       38        31
            | .0135376  .0112974
            |       57        63
            | 
      Black |    2,669     2,914
            |       36        43
            | .0134882  .0147563
            |       75        78
            | 
      Mixed |    2,835     2,837
            |       45        43
            |  .015873  .0151569
            |       66        79
            | 
      Other |    5,505     5,582
            |       82        80
            | .0148955  .0143318
            |      128       125
            | 
    Missing |   18,810    18,589
            |      275       277
            | .0146199  .0149013
            |      449       456
--------------------------------
Table eth2

------------------------------
Ethnicity |
in 2      |
catergori |  SGTF (exposure)  
es        |  non-VOC       VOC
----------+-------------------
    White |   41,662    41,855
          |      647       625
          | .0155297  .0149325
          |     1018      1039
          | 
    Other |   13,816    14,077
          |      201       197
          | .0145484  .0139945
          |      326       345
          | 
  Missing |   18,810    18,589
          |      275       277
          | .0146199  .0149013
          |      449       456
------------------------------
Table smoke_nomiss

------------------------------
Smoking   |
status    |
(missing  |
set to    |  SGTF (exposure)  
never)    |  non-VOC       VOC
----------+-------------------
    Never |   63,833    64,117
          |      973       948
          | .0152429  .0147855
          |     1545      1575
          | 
   Former |    1,493     1,475
          |       25        27
          | .0167448  .0183051
          |       46        37
          | 
  Current |    8,962     8,929
          |      125       124
          | .0139478  .0138873
          |      202       228
------------------------------
Table smoke_nomiss2

------------------------------
Binary    |
smoking   |
status    |
(missing  |
set to    |  SGTF (exposure)  
never)    |  non-VOC       VOC
----------+-------------------
    Never |    2,934     2,946
          |       40        31
          | .0136333  .0105227
          |       74        62
          | 
   Former |   10,455    10,404
          |      150       151
          | .0143472  .0145136
          |      248       265
------------------------------
Table obese4cat

-----------------------------------------
Evidence of obesity  |
(missing set to      |  SGTF (exposure)  
none)                |  non-VOC       VOC
---------------------+-------------------
No record of obesity |   30,318    30,386
                     |      455       439
                     | .0150076  .0144474
                     |      743       745
                     | 
   Obese I (30-34.9) |   13,486    13,399
                     |      211       208
                     | .0156459  .0155235
                     |      327       333
                     | 
  Obese II (35-39.9) |   13,634    13,400
                     |      191       208
                     | .0140091  .0155224
                     |      308       340
                     | 
     Obese III (40+) |   16,850    17,336
                     |      266       244
                     | .0157863  .0140748
                     |      415       422
-----------------------------------------
Table hh_total_cat

------------------------------
Categoric |
al        |
household |  SGTF (exposure)  
size      |  non-VOC       VOC
----------+-------------------
      1-2 |   35,386    35,663
          |      544       531
          | .0153733  .0148894
          |      882       882
          | 
      3-5 |   37,099    37,064
          |      551       544
          | .0148522  .0146773
          |      874       911
          | 
     6-10 |      105        92
          |        1         1
          | .0095238  .0108696
          |        1         1
------------------------------
Table stp

------------------------------
Sustainab |
ility and |
Transform |
ation     |
Partnersh |  SGTF (exposure)  
ip        |  non-VOC       VOC
----------+-------------------
        1 |    7,495     7,271
          |      105       112
          | .0140093  .0154037
          |      188       197
          | 
        2 |    7,388     7,438
          |      109       125
          | .0147537  .0168056
          |      165       209
          | 
        3 |    7,366     7,531
          |      119       106
          | .0161553  .0140752
          |      176       170
          | 
        4 |    7,467     7,562
          |      114       107
          | .0152672  .0141497
          |      177       173
          | 
        5 |    7,333     7,496
          |      110       104
          | .0150007  .0138741
          |      179       168
          | 
        6 |    7,551     7,487
          |      127       115
          |  .016819    .01536
          |      194       187
          | 
        7 |    7,270     7,562
          |      112       106
          | .0154058  .0140175
          |      163       180
          | 
        8 |    7,387     7,492
          |      109       109
          | .0147557  .0145489
          |      187       174
          | 
        9 |    7,481     7,499
          |      114       100
          | .0152386  .0133351
          |      188       184
          | 
       10 |    7,550     7,183
          |      104       115
          | .0137748    .01601
          |      176       198
------------------------------
Table region

---------------------------------------------
                         |  SGTF (exposure)  
      NHS England region |  non-VOC       VOC
-------------------------+-------------------
           East Midlands |    7,339     7,477
                         |      121        89
                         | .0164873  .0119032
                         |      174       177
                         | 
                  London |   14,867    14,901
                         |      233       212
                         | .0156723  .0142272
                         |      388       349
                         | 
              North East |    7,458     7,401
                         |      109       115
                         | .0146152  .0155384
                         |      176       181
                         | 
              North West |    7,383     7,413
                         |      113       100
                         | .0153054  .0134898
                         |      174       177
                         | 
              South East |    7,504     7,475
                         |      117       134
                         | .0155917  .0179264
                         |      190       190
                         | 
              South West |    7,330     7,566
                         |      117       115
                         | .0159618  .0151996
                         |      182       194
                         | 
           West Midlands |    7,411     7,356
                         |      102       121
                         | .0137633  .0164492
                         |      169       199
                         | 
Yorkshire and the Humber |    7,441     7,370
                         |      117       112
                         | .0157237  .0151967
                         |      179       195
---------------------------------------------
Table rural_urban5

------------------------------------------------
Rural Urban in five         |  SGTF (exposure)  
categories                  |  non-VOC       VOC
----------------------------+-------------------
    Urban major conurbation |    7,386     7,604
                            |      114       102
                            | .0154346   .013414
                            |      173       183
                            | 
    Urban minor conurbation |    7,455     7,328
                            |      109       101
                            | .0146211  .0137828
                            |      178       174
                            | 
        Urban city and town |   14,868    14,885
                            |      234       231
                            | .0157385   .015519
                            |      393       368
                            | 
      Rural town and fringe |   14,853    14,917
                            |      206       236
                            | .0138693  .0158209
                            |      334       387
                            | 
Rural village and dispersed |   29,726    29,787
                            |      460       429
                            | .0154747  .0144023
                            |      715       728
------------------------------------------------
Table comorb_cat

-------------------------------------
Categorical      |
number of        |  SGTF (exposure)  
comorbidites     |  non-VOC       VOC
-----------------+-------------------
  No comorbidity |    4,710     4,839
                 |       77        78
                 | .0163482   .016119
                 |      136       119
                 | 
   1 comorbidity |   15,870    15,743
                 |      232       253
                 | .0146188  .0160706
                 |      361       398
                 | 
2+ comorbidities |   53,708    53,939
                 |      814       768
                 |  .015156  .0142383
                 |     1296      1323
-------------------------------------
Table start_week

--------------------------------
Epidemiolog |
ical week   |  SGTF (exposure)  
of study    |  non-VOC       VOC
------------+-------------------
16Nov-22Nov |   10,339    10,649
            |      154       146
            | .0148951  .0137102
            |      329       353
            | 
23Nov-29Nov |   11,602    11,676
            |      198       169
            |  .017066  .0144741
            |      379       379
            | 
30Nov-06Dec |   11,113    11,384
            |      172       176
            | .0154774  .0154603
            |      298       317
            | 
07Dec-13Dec |   10,944    10,743
            |      156       153
            | .0142544  .0142418
            |      246       249
            | 
14Dec-20Dec |   10,240    10,186
            |      142       165
            | .0138672  .0161987
            |      213       226
            | 
21Dec-27Dec |    9,561     9,667
            |      149       142
            | .0155841  .0146891
            |      182       172
            | 
28Dec-04Jan |   10,489    10,216
            |      152       148
            | .0144914  .0144871
            |      146       144
--------------------------------

. 
. 
. * Plot SGTF proportion by NHS region
. 
. /*
> clear
> import delimited "C:\Users\EIDEDGRI\Documents\GitHub\SGTF-CFR-research\lookup
> s\VOC_Data_England.csv"
> 
> gen week_date = date(week, "DMY")
> format week_date %td
> 
> drop if week_date < date("16nov2020", "DMY")
> 
> gen start_week = 10 if week_date <= date("24jan2021", "DMY")
> replace start_week = 9 if week_date <= date("17jan2021", "DMY")
> replace start_week = 8 if week_date <= date("10jan2021", "DMY")
> replace start_week = 7 if week_date <= date("03jan2021", "DMY")
> replace start_week = 6 if week_date <= date("27dec2020", "DMY")
> replace start_week = 5 if week_date <= date("20dec2020", "DMY")
> replace start_week = 4 if week_date <= date("13dec2020", "DMY")
> replace start_week = 3 if week_date <= date("06dec2020", "DMY")
> replace start_week = 2 if week_date <= date("29nov2020", "DMY")
> replace start_week = 1 if week_date <= date("22nov2020", "DMY")
> 
> rename percent_confirmedsgtf phe_sgtf
> rename n_total phe_n
> 
> rename region region_s
> 
> gen region=0 if region_s=="East of England"
> replace region=1 if region_s=="East Midlands"
> replace region=2 if region_s=="London"
> replace region=3 if region_s=="North East"
> replace region=4 if region_s=="North West"
> replace region=5 if region_s=="South East"
> replace region=6 if region_s=="South West"
> replace region=7 if region_s=="West Midlands"
> replace region=8 if region_s=="Yorkshire and Humber"
> 
> keep region start_week week phe_sgtf phe_n
> 
> save "C:\Users\EIDEDGRI\Documents\GitHub\SGTF-CFR-research\lookups\VOC_Data_E
> ngland.dta"
> */
. 
. 
. * Drop if unknown SGTF
. drop if !inrange(sgtf,0,1)
(0 observations deleted)

. 
. * Calculate % SGTF by week and region
. collapse (mean) sgtf (count) patient_id, by(region start_week)

. 
. gen os_sgtf = sgtf*100

. rename patient_id os_n

. 
. * Merge on PHE data
. /*
> merge 1:1 region start_week using "C:\Users\EIDEDGRI\Documents\GitHub\SGTF-CF
> R-research\lookups\VOC_Data_England.dta"
> */
. 
. merge 1:1 region start_week using ./lookups/VOC_Data_England.dta

    Result                           # of obs.
    -----------------------------------------
    not matched                            41
        from master                         7  (_merge==1)
        from using                         34  (_merge==2)

    matched                                56  (_merge==3)
    -----------------------------------------

. sort region start_week

. 
. gen week_date = date(week, "DMY")
(7 missing values generated)

. format week_date %td

. 
. label define epi_week   1 "47" 2 "48" 3 "49" 4 "50" 5 "51" 6 "52" 7 "53" 8 "1
> " 9 "2" 10 "3"

. label values start_week epi_week

. 
. 
. line phe_sgtf os_sgtf start_week, by(region) ///
>         ytitle("% of positive tests with SGTF") ///
>         xlabel(1(1)10, valuelabel) ///
>         legend(label(1 "PHE") label(2 "TPP"))

. graph export ./output/sgtf_perc_region.svg, as(svg) replace
(note: file ./output/sgtf_perc_region.svg not found)
(file ./output/sgtf_perc_region.svg written in SVG format)

. 
. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/an_summary.log
  log type:  text
 closed on:  13 Feb 2021, 17:30:28
-------------------------------------------------------------------------------
