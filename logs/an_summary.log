-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /workspace/logs/an_summary.log
  log type:  text
 opened on:  12 Feb 2021, 16:49:09

. 
. clear

. 
. /*
> use "C:\Users\EIDEDGRI\Documents\GitHub\SGTF-CFR-research\output\cr_analysis_
> dataset.dta"
> */
. 
. use ./output/cr_analysis_dataset.dta
(SGTF CFR ANALYSIS DATASET: 12 Feb 2021)

. 
. 
. * Tabulate number of deaths by SGTF and covariates
. 
. foreach var of varlist agegroup male imd eth5 smoke_nomiss obese4cat hh_total
> _cat stp region ///
>                         utla_group rural_urban5 comorb_cat start_week {
  2.                         
.                         noi disp "Table `var'"
  3.                         table `var' sgtf, missing contents(count patient_i
> d sum risk_28 sum cox_death)  
  4.                         }
Table agegroup

----------------------------
          | Exposure: 0=VOC;
Grouped   |    1=non-VOC    
age       | non-VOC      VOC
----------+-----------------
    0-<18 |  15,796   15,530
          |     237      225
          |     302      306
          | 
   18-<30 |  11,266   11,320
          |     145      160
          |     200      229
          | 
   30-<40 |   9,915    9,795
          |     142      147
          |     174      196
          | 
   40-<50 |   9,443    9,483
          |     136      126
          |     179      164
          | 
   50-<60 |   9,968    9,996
          |     139      133
          |     182      179
          | 
   60-<70 |   7,818    7,913
          |     119      111
          |     169      155
          | 
   70-<80 |   6,133    6,127
          |     102       81
          |     122      110
          | 
      80+ |   3,602    3,636
          |      42       57
          |      66       80
----------------------------
Table male

----------------------------
          | Exposure: 0=VOC;
          |    1=non-VOC    
     Male | non-VOC      VOC
----------+-----------------
        F |  37,569   37,549
          |     533      515
          |     717      712
          | 
        M |  36,372   36,251
          |     529      525
          |     677      707
----------------------------
Table imd

-----------------------------------
Index of         |
Multiple         | Exposure: 0=VOC;
Deprivation      |    1=non-VOC    
(IMD)            | non-VOC      VOC
-----------------+-----------------
1 least deprived |  22,204   22,097
                 |     301      310
                 |     411      421
                 | 
               2 |  14,731   14,649
                 |     214      212
                 |     284      295
                 | 
               3 |  14,787   14,828
                 |     217      215
                 |     268      286
                 | 
               4 |  14,921   14,794
                 |     221      187
                 |     281      258
                 | 
 5 most deprived |   7,298    7,432
                 |     109      116
                 |     150      159
-----------------------------------
Table eth5

------------------------------
Ethnicity   | Exposure: 0=VOC;
in 5        |    1=non-VOC    
categories  | non-VOC      VOC
------------+-----------------
      White |  41,588   41,561
            |     616      581
            |     815      785
            | 
South Asian |   2,777    2,769
            |      37       34
            |      51       56
            | 
      Black |   2,827    2,828
            |      39       31
            |      59       46
            | 
      Mixed |   2,691    2,797
            |      41       47
            |      52       58
            | 
      Other |   5,504    5,373
            |      96       82
            |     107      114
------------------------------
Table smoke_nomiss

----------------------------
Smoking   |
status    |
(missing  | Exposure: 0=VOC;
set to    |    1=non-VOC    
never)    | non-VOC      VOC
----------+-----------------
    Never |  63,557   63,561
          |     922      901
          |    1198     1220
          | 
   Former |   1,468    1,447
          |      19       18
          |      23       34
          | 
  Current |   8,916    8,792
          |     121      121
          |     173      165
----------------------------
Table obese4cat

---------------------------------------
Evidence of obesity  | Exposure: 0=VOC;
(missing set to      |    1=non-VOC    
none)                | non-VOC      VOC
---------------------+-----------------
No record of obesity |  29,885   30,176
                     |     426      441
                     |     586      590
                     | 
   Obese I (30-34.9) |  13,615   13,222
                     |     192      198
                     |     242      269
                     | 
  Obese II (35-39.9) |  13,587   13,525
                     |     188      166
                     |     254      236
                     | 
     Obese III (40+) |  16,854   16,877
                     |     256      235
                     |     312      324
---------------------------------------
Table hh_total_cat

----------------------------
Categoric |
al        | Exposure: 0=VOC;
household |    1=non-VOC    
size      | non-VOC      VOC
----------+-----------------
      1-2 |  35,081   35,068
          |     494      494
          |     647      674
          | 
      3-5 |  37,092   36,982
          |     546      528
          |     720      721
          | 
     6-10 |     107      103
          |       3        1
          |       3        1
----------------------------
Table stp

----------------------------
Sustainab |
ility and |
Transform |
ation     | Exposure: 0=VOC;
Partnersh |    1=non-VOC    
ip        | non-VOC      VOC
----------+-----------------
        1 |   7,251    7,477
          |     121      108
          |     149      142
          | 
        2 |   7,560    7,444
          |     111       99
          |     147      135
          | 
        3 |   7,443    7,311
          |     108      110
          |     142      166
          | 
        4 |   7,481    7,540
          |     128      112
          |     159      143
          | 
        5 |   7,344    7,378
          |      98       88
          |     133      116
          | 
        6 |   7,307    7,434
          |      96      103
          |     125      145
          | 
        7 |   7,331    7,314
          |      99      105
          |     140      138
          | 
        8 |   7,383    7,246
          |      93      100
          |     126      145
          | 
        9 |   7,415    7,378
          |     100      114
          |     134      152
          | 
       10 |   7,426    7,278
          |     108      101
          |     139      137
----------------------------
Table region

---------------------------------------
                     | Exposure: 0=VOC;
                     |    1=non-VOC    
  NHS England region | non-VOC      VOC
---------------------+-----------------
                East |   7,314    7,356
                     |      95       94
                     |     128      119
                     | 
       East Midlands |   7,387    7,340
                     |     106      106
                     |     148      142
                     | 
              London |  14,841   14,821
                     |     207      212
                     |     263      280
                     | 
          North East |   7,551    7,366
                     |     101      111
                     |     134      159
                     | 
          North West |   7,317    7,313
                     |     110       95
                     |     137      136
                     | 
          South East |   7,349    7,363
                     |     107      103
                     |     139      153
                     | 
          South West |   7,379    7,351
                     |     111      113
                     |     142      158
                     | 
       West Midlands |   7,428    7,575
                     |     102      115
                     |     144      150
                     | 
Yorkshire and Humber |   7,375    7,315
                     |     123       91
                     |     159      122
---------------------------------------
Table utla_group

---------------------------------------
                     | Exposure: 0=VOC;
                     |    1=non-VOC    
                UTLA | non-VOC      VOC
---------------------+-----------------
Barking and Dagenham |     255      237
                     |       8        2
                     |       8        3
                     | 
              Barnet |     466      437
                     |       4        6
                     |       5       10
                     | 
            Barnsley |     325      334
                     |       2        3
                     |       2        6
                     | 
 Bath and North East |     276      304
                     |       3        8
                     |       3        9
                     | 
             Bedford |     198      208
                     |       3        1
                     |       4        2
                     | 
              Bexley |     308      329
                     |       4        6
                     |       4        6
                     | 
          Birmingham |   1,479    1,425
                     |      27       17
                     |      33       25
                     | 
Blackburn with Darwe |     192      200
                     |       1        3
                     |       2        4
                     | 
           Blackpool |     229      223
                     |       1        3
                     |       4        3
                     | 
              Bolton |     390      369
                     |       3        4
                     |       4        4
                     | 
Bournemouth, Christc |     539      507
                     |       9        4
                     |      11        7
                     | 
    Bracknell Forest |     163      184
                     |       1        4
                     |       1        4
                     | 
            Bradford |     726      669
                     |       8        6
                     |      11        9
                     | 
               Brent |     388      367
                     |       6        7
                     |      11        9
                     | 
   Brighton and Hove |     356      379
                     |       2        4
                     |       3        6
                     | 
    Bristol, City of |     586      591
                     |       5        9
                     |       8       13
                     | 
             Bromley |     432      417
                     |       8        4
                     |       7        4
                     | 
     Buckinghamshire |     744      739
                     |      13       14
                     |      16       19
                     | 
                Bury |     296      258
                     |       6        3
                     |       7        5
                     | 
          Calderdale |     296      303
                     |       3        2
                     |       7        3
                     | 
      Cambridgeshire |     797      846
                     |      12       11
                     |      17       13
                     | 
              Camden |     333      256
                     |       8        7
                     |       9       11
                     | 
Central Bedfordshire |     375      354
                     |       4        4
                     |       9        5
                     | 
       Cheshire East |     584      563
                     |       7       12
                     |      10       16
                     | 
Cheshire West and Ch |     538      477
                     |       3        8
                     |       6       11
                     | 
      City of London |      13        8
                     |       0        1
                     |       0        1
                     | 
            Cornwall |     847      816
                     |      15       10
                     |      26       12
                     | 
       County Durham |     750      735
                     |      12       13
                     |      11       18
                     | 
            Coventry |     432      448
                     |      10        4
                     |      20        9
                     | 
             Croydon |     486      476
                     |       8        5
                     |      10        8
                     | 
             Cumbria |     684      676
                     |      15       10
                     |      19       12
                     | 
          Darlington |     179      177
                     |       2        2
                     |       2        4
                     | 
               Derby |     332      347
                     |       2        8
                     |       2       11
                     | 
          Derbyshire |   1,047    1,026
                     |      16        9
                     |      20       13
                     | 
               Devon |   1,201    1,126
                     |      21       24
                     |      25       31
                     | 
           Doncaster |     433      444
                     |       4        2
                     |       6        4
                     | 
              Dorset |     517      490
                     |       3        1
                     |       3        5
                     | 
              Dudley |     469      453
                     |       9        5
                     |       9        5
                     | 
              Ealing |     394      436
                     |       3       10
                     |       7       10
                     | 
East Riding of Yorks |     427      467
                     |       7        4
                     |       8        7
                     | 
         East Sussex |     763      767
                     |       9        8
                     |      11       13
                     | 
             Enfield |     427      380
                     |       9        6
                     |      12        8
                     | 
               Essex |   1,860    1,897
                     |      33       26
                     |      36       39
                     | 
           Gateshead |     280      291
                     |       3        7
                     |       4        7
                     | 
     Gloucestershire |     753      865
                     |      11       19
                     |      12       22
                     | 
           Greenwich |     352      387
                     |       5       10
                     |       8       15
                     | 
             Hackney |     280      340
                     |       6        7
                     |       6        8
                     | 
              Halton |     163      163
                     |       6        0
                     |       5        0
                     | 
Hammersmith and Fulh |     269      258
                     |       3        1
                     |       5        1
                     | 
           Hampshire |   1,844    1,763
                     |      23       15
                     |      35       25
                     | 
            Haringey |     383      403
                     |       4        4
                     |       5        6
                     | 
              Harrow |     346      353
                     |       7        4
                     |       9        7
                     | 
          Hartlepool |     123      133
                     |       3        0
                     |       5        1
                     | 
            Havering |     292      331
                     |       1        4
                     |       3        5
                     | 
Herefordshire, Count |     249      263
                     |       5        2
                     |       5        5
                     | 
       Hertfordshire |   1,637    1,674
                     |      24       24
                     |      32       26
                     | 
          Hillingdon |     352      367
                     |       5        1
                     |       4        2
                     | 
            Hounslow |     326      303
                     |       3        4
                     |       4        7
                     | 
       Isle of Wight |     206      196
                     |       2        3
                     |       2        5
                     | 
     Isles of Scilly |      11        8
                     |       0        0
                     |       1        0
                     | 
           Islington |     249      252
                     |       3        5
                     |       3        6
                     | 
Kensington and Chels |     231      219
                     |       3        4
                     |       2        5
                     | 
                Kent |   1,939    2,002
                     |      23       20
                     |      33       31
                     | 
 Kingston upon Hull, |     355      369
                     |       4        8
                     |       7        9
                     | 
Kingston upon Thames |     214      223
                     |       3        5
                     |       4        5
                     | 
            Kirklees |     641      628
                     |      10        8
                     |      15        9
                     | 
            Knowsley |     246      195
                     |       3        4
                     |       5        5
                     | 
             Lambeth |     397      327
                     |       5        5
                     |       6        7
                     | 
          Lancashire |   1,701    1,604
                     |      21       19
                     |      32       25
                     | 
               Leeds |   1,181    1,144
                     |      18       21
                     |      24       25
                     | 
           Leicester |     358      383
                     |       3        7
                     |       3       11
                     | 
      Leicestershire |     891      916
                     |       8       11
                     |      11       21
                     | 
            Lewisham |     381      400
                     |       4        6
                     |       5        9
                     | 
        Lincolnshire |     963      950
                     |      21       15
                     |      26       24
                     | 
           Liverpool |     624      643
                     |       4        7
                     |       8       11
                     | 
               Luton |     221      236
                     |       3        3
                     |       2        4
                     | 
          Manchester |     634      643
                     |      10        8
                     |      12       17
                     | 
              Medway |     413      375
                     |       8        6
                     |      10        8
                     | 
              Merton |     259      256
                     |       5        2
                     |       4        3
                     | 
       Middlesbrough |     186      187
                     |       3        3
                     |       4        7
                     | 
       Milton Keynes |     334      345
                     |       5        3
                     |       8        3
                     | 
 Newcastle upon Tyne |     311      323
                     |       7        5
                     |       6        6
                     | 
              Newham |     389      425
                     |      12        6
                     |      12        6
                     | 
             Norfolk |   1,200    1,214
                     |      19       26
                     |      22       29
                     | 
North East Lincolnsh |     242      261
                     |       2        2
                     |       4        3
                     | 
  North Lincolnshire |     239      239
                     |       4        3
                     |       5        3
                     | 
      North Somerset |     270      273
                     |       5        5
                     |       4        7
                     | 
      North Tyneside |     308      319
                     |       5        6
                     |       6        9
                     | 
     North Yorkshire |     827      823
                     |       9       13
                     |      11       17
                     | 
    Northamptonshire |   1,013      930
                     |      20       17
                     |      26       20
                     | 
      Northumberland |     431      414
                     |       3        4
                     |       4        3
                     | 
          Nottingham |     423      418
                     |       5        8
                     |       9        9
                     | 
     Nottinghamshire |   1,022    1,103
                     |      15       13
                     |      18       22
                     | 
              Oldham |     339      377
                     |       9        7
                     |       9        8
                     | 
         Oxfordshire |     935      922
                     |      16       13
                     |      20       16
                     | 
        Peterborough |     242      259
                     |       4        2
                     |       9        4
                     | 
            Plymouth |     359      363
                     |       5        7
                     |       6        8
                     | 
          Portsmouth |     273      272
                     |       1        4
                     |       4        5
                     | 
             Reading |     202      187
                     |       4        0
                     |       4        1
                     | 
           Redbridge |     362      354
                     |      11        0
                     |      14        0
                     | 
Redcar and Cleveland |     184      214
                     |       2        4
                     |       3        6
                     | 
Richmond upon Thames |     227      231
                     |       6        0
                     |       7        3
                     | 
            Rochdale |     260      281
                     |       1        4
                     |       2        6
                     | 
           Rotherham |     357      361
                     |       0        3
                     |       2        8
                     | 
             Rutland |      47       68
                     |       0        1
                     |       0        2
                     | 
             Salford |     293      312
                     |       3        5
                     |       4        7
                     | 
            Sandwell |     383      407
                     |       4        5
                     |       5        4
                     | 
              Sefton |     424      417
                     |       6        4
                     |       6        8
                     | 
           Sheffield |     741      780
                     |       7       11
                     |       8       14
                     | 
          Shropshire |     394      402
                     |       4        4
                     |       9        5
                     | 
              Slough |     158      137
                     |       1        2
                     |       1        3
                     | 
            Solihull |     315      315
                     |       5        4
                     |       7        4
                     | 
            Somerset |     774      753
                     |      10       11
                     |      13       15
                     | 
South Gloucestershir |     360      365
                     |       5        7
                     |       6        7
                     | 
      South Tyneside |     271      283
                     |       3        3
                     |       3        2
                     | 
         Southampton |     366      353
                     |       7        7
                     |      10        7
                     | 
     Southend-on-Sea |     206      190
                     |       3        4
                     |       3        4
                     | 
           Southwark |     383      366
                     |       4       11
                     |       6       13
                     | 
          St. Helens |     243      237
                     |       1        2
                     |       2        3
                     | 
       Staffordshire |   1,194    1,247
                     |      20       20
                     |      25       29
                     | 
           Stockport |     451      465
                     |      13        4
                     |      14        7
                     | 
    Stockton-on-Tees |     279      250
                     |       9        3
                     |      10        3
                     | 
      Stoke-on-Trent |     356      369
                     |       7       10
                     |       9       11
                     | 
             Suffolk |     959      962
                     |      11       12
                     |      17       17
                     | 
          Sunderland |     381      403
                     |       7        3
                     |      10        6
                     | 
              Surrey |   1,567    1,649
                     |      23       23
                     |      31       26
                     | 
              Sutton |     244      279
                     |       1        5
                     |       1        7
                     | 
             Swindon |     312      320
                     |       9        5
                     |      11        6
                     | 
            Tameside |     355      338
                     |       5        3
                     |       8        5
                     | 
  Telford and Wrekin |     254      254
                     |       0        2
                     |       1        3
                     | 
            Thurrock |     224      208
                     |       8        4
                     |      10        7
                     | 
              Torbay |     184      205
                     |       1        1
                     |       2        1
                     | 
       Tower Hamlets |     382      336
                     |       8        8
                     |      14       13
                     | 
            Trafford |     304      281
                     |       6        9
                     |       9       13
                     | 
           Wakefield |     537      489
                     |       8        5
                     |       9        7
                     | 
             Walsall |     433      464
                     |       8        5
                     |       9        7
                     | 
      Waltham Forest |     293      275
                     |       4        5
                     |       5        8
                     | 
          Wandsworth |     420      465
                     |       5        5
                     |       8        7
                     | 
          Warrington |     267      243
                     |       1        5
                     |       1        4
                     | 
        Warwickshire |     740      640
                     |       7       12
                     |      10       17
                     | 
      West Berkshire |     244      243
                     |       5        1
                     |       4        2
                     | 
         West Sussex |   1,130    1,072
                     |      12       13
                     |      16       18
                     | 
         Westminster |     297      246
                     |       5        5
                     |       6        5
                     | 
               Wigan |     432      420
                     |       5        5
                     |       9       10
                     | 
           Wiltshire |     683      689
                     |       5       12
                     |       8       17
                     | 
Windsor and Maidenhe |     189      211
                     |       1        2
                     |       2        4
                     | 
              Wirral |     502      434
                     |      10        5
                     |      12        9
                     | 
           Wokingham |     227      246
                     |       5        5
                     |       4        8
                     | 
       Wolverhampton |     325      363
                     |       4       10
                     |       7       11
                     | 
      Worcestershire |     906      964
                     |       8       19
                     |      15       22
                     | 
                York |     281      282
                     |       6        6
                     |       9        8
---------------------------------------
Table rural_urban5

----------------------------------------------
                            | Exposure: 0=VOC;
Rural Urban in five         |    1=non-VOC    
categories                  | non-VOC      VOC
----------------------------+-----------------
    Urban major conurbation |   7,397    7,345
                            |     114      102
                            |     141      154
                            | 
    Urban minor conurbation |   7,436    7,476
                            |      93       93
                            |     131      128
                            | 
        Urban city and town |  14,706   14,673
                            |     225      201
                            |     282      273
                            | 
      Rural town and fringe |  14,835   14,702
                            |     217      217
                            |     278      301
                            | 
Rural village and dispersed |  29,567   29,604
                            |     413      427
                            |     562      563
----------------------------------------------
Table comorb_cat

-----------------------------------
Categorical      | Exposure: 0=VOC;
number of        |    1=non-VOC    
comorbidites     | non-VOC      VOC
-----------------+-----------------
  No comorbidity |   4,856    4,852
                 |      77       59
                 |      91       87
                 | 
   1 comorbidity |  15,484   15,446
                 |     216      200
                 |     273      274
                 | 
2+ comorbidities |  53,601   53,502
                 |     769      781
                 |    1030     1058
-----------------------------------
Table start_week

------------------------------
Epidemiolog | Exposure: 0=VOC;
ical week   |    1=non-VOC    
of study    | non-VOC      VOC
------------+-----------------
16Nov-22Nov |  10,395   10,264
            |     147      156
            |     296      304
            | 
23Nov-29Nov |  11,734   11,358
            |     207      179
            |     311      302
            | 
30Nov-06Dec |  11,298   11,314
            |     191      211
            |     251      283
            | 
07Dec-13Dec |  10,745   10,758
            |     186      156
            |     213      191
            | 
14Dec-20Dec |  10,101   10,237
            |     150      158
            |     148      161
            | 
21Dec-27Dec |   9,499    9,590
            |     113      108
            |     105      100
            | 
28Dec-04Jan |  10,169   10,279
            |      68       72
            |      70       78
------------------------------

. 
. 
. * Plot SGTF proportion by NHS region
. 
. /*
> clear
> import delimited "C:\Users\EIDEDGRI\Documents\GitHub\SGTF-CFR-research\lookup
> s\VOC_Data_England.csv"
> 
> gen week_date = date(week, "DMY")
> format week_date %td
> 
> drop if week_date < date("16nov2020", "DMY")
> 
> gen start_week = 10 if week_date <= date("24jan2021", "DMY")
> replace start_week = 9 if week_date <= date("17jan2021", "DMY")
> replace start_week = 8 if week_date <= date("10jan2021", "DMY")
> replace start_week = 7 if week_date <= date("03jan2021", "DMY")
> replace start_week = 6 if week_date <= date("27dec2020", "DMY")
> replace start_week = 5 if week_date <= date("20dec2020", "DMY")
> replace start_week = 4 if week_date <= date("13dec2020", "DMY")
> replace start_week = 3 if week_date <= date("06dec2020", "DMY")
> replace start_week = 2 if week_date <= date("29nov2020", "DMY")
> replace start_week = 1 if week_date <= date("22nov2020", "DMY")
> 
> rename percent_confirmedsgtf phe_sgtf
> rename n_total phe_n
> 
> rename region region_s
> 
> gen region=0 if region_s=="East of England"
> replace region=1 if region_s=="East Midlands"
> replace region=2 if region_s=="London"
> replace region=3 if region_s=="North East"
> replace region=4 if region_s=="North West"
> replace region=5 if region_s=="South East"
> replace region=6 if region_s=="South West"
> replace region=7 if region_s=="West Midlands"
> replace region=8 if region_s=="Yorkshire and Humber"
> 
> keep region start_week week phe_sgtf phe_n
> 
> save "C:\Users\EIDEDGRI\Documents\GitHub\SGTF-CFR-research\lookups\VOC_Data_E
> ngland.dta"
> */
. 
. 
. * Drop if unknown SGTF
. drop if !inrange(sgtf,0,1)
(0 observations deleted)

. 
. * Calculate % SGTF by week and region
. collapse (mean) sgtf (count) patient_id, by(region start_week)

. 
. gen os_sgtf = sgtf*100

. rename patient_id os_n

. 
. * Merge on PHE data
. /*
> merge 1:1 region start_week using "C:\Users\EIDEDGRI\Documents\GitHub\SGTF-CF
> R-research\lookups\VOC_Data_England.dta"
> */
. 
. merge 1:1 region start_week using ./lookups/VOC_Data_England.dta

    Result                           # of obs.
    -----------------------------------------
    not matched                            27
        from master                         0  (_merge==1)
        from using                         27  (_merge==2)

    matched                                63  (_merge==3)
    -----------------------------------------

. sort region start_week

. 
. gen week_date = date(week, "DMY")

. format week_date %td

. 
. label define epi_week   1 "47" 2 "48" 3 "49" 4 "50" 5 "51" 6 "52" 7 "53" 8 "1
> " 9 "2" 10 "3"

. label values start_week epi_week

. 
. 
. line phe_sgtf os_sgtf start_week, by(region) ///
>         ytitle("% of positive tests with SGTF") ///
>         xlabel(1(1)10, valuelabel) ///
>         legend(label(1 "PHE") label(2 "TPP"))

. graph export ./output/sgtf_perc_region.svg, as(svg) replace
(note: file ./output/sgtf_perc_region.svg not found)
(file ./output/sgtf_perc_region.svg written in SVG format)

. 
. 
. log close
      name:  <unnamed>
       log:  /workspace/logs/an_summary.log
  log type:  text
 closed on:  12 Feb 2021, 16:49:21
-------------------------------------------------------------------------------
