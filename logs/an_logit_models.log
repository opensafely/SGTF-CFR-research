-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /workspace/logs/an_logit_models.log
  log type:  text
 opened on:  23 Feb 2021, 20:47:14

. 
. clear

. 
. /*
> use "C:\Users\EIDEDGRI\Documents\GitHub\SGTF-CFR-research\output\cr_analysis_
> dataset.dta"
> */
. 
. use ./output/cr_analysis_dataset.dta
(SGTF CFR ANALYSIS DATASET: 20 Feb 2021)

. 
. * DROP MISSING UTLA
. noi di "DROPPING MISSING UTLA DATA"
DROPPING MISSING UTLA DATA

. drop if utla_group==""
(37 observations deleted)

. 
. * DROP IF NO DATA ON SGTF
. noi di "DROPPING NO SGTF DATA" 
DROPPING NO SGTF DATA

. drop if has_sgtf==0
(37,027 observations deleted)

. 
. noi di "SUBSETTING ON 28-DAY RISK POPULATION"
SUBSETTING ON 28-DAY RISK POPULATION

. keep if risk_pop==1
(0 observations deleted)

. 
. tab sgtf risk_28, row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

        SGTF |    28-day outcome
  (exposure) |         0          1 |     Total
-------------+----------------------+----------
     non-VOC |    73,145      1,128 |    74,273 
             |     98.48       1.52 |    100.00 
-------------+----------------------+----------
         VOC |    73,401      1,106 |    74,507 
             |     98.52       1.48 |    100.00 
-------------+----------------------+----------
       Total |   146,546      2,234 |   148,780 
             |     98.50       1.50 |    100.00 

. 
. 
. 
. *******************
. /* Unadjusted OR */
. *******************
. 
. glm risk_28 i.sgtf, family(bin) link(logit) eform

Iteration 0:   log likelihood = -18707.402  
Iteration 1:   log likelihood = -11616.057  
Iteration 2:   log likelihood = -11596.895  
Iteration 3:   log likelihood = -11596.835  
Iteration 4:   log likelihood = -11596.835  

Generalized linear models                         Number of obs   =    148,780
Optimization     : ML                             Residual df     =    148,778
                                                  Scale parameter =          1
Deviance         =  23193.67039                   (1/df) Deviance =   .1558945
Pearson          =       148780                   (1/df) Pearson  =   1.000013

Variance function: V(u) = u*(1-u)                 [Bernoulli]
Link function    : g(u) = ln(u/(1-u))             [Logit]

                                                  AIC             =   .1559193
Log likelihood   = -11596.83519                   BIC             =   -1748786

------------------------------------------------------------------------------
             |                 OIM
     risk_28 | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        sgtf |
        VOC  |   .9770768   .0416604    -0.54   0.587     .8987427    1.062238
       _cons |   .0154214   .0004627  -139.05   0.000     .0145407    .0163555
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.

. 
. * Absolute odds
. margins sgtf

Adjusted predictions                            Number of obs     =    148,780
Model VCE    : OIM

Expression   : Predicted mean risk_28, predict()

------------------------------------------------------------------------------
             |            Delta-method
             |     Margin   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        sgtf |
    non-VOC  |   .0151872   .0004487    33.84   0.000     .0143077    .0160667
        VOC  |   .0148442    .000443    33.51   0.000     .0139759    .0157126
------------------------------------------------------------------------------

. 
. 
. 
. *********************************************************************
. /* Demographically adjusted OR - age as spline, continuous hh size */
. /* Not adjusting for comorbidities, obesity, or smoking status     */
. *********************************************************************
. 
. glm risk_28 i.sgtf i.male ib1.imd ib1.eth2 household_size i.home_bin ///
>                         i.region ib1.rural_urban5 ib1.start_week age1 age2 ag
> e3 ///
>                         if eth2 != 6 ///
>                         , family(bin) link(logit) eform

Iteration 0:   log likelihood = -12672.885  
Iteration 1:   log likelihood = -7938.7318  
Iteration 2:   log likelihood = -7923.0165  
Iteration 3:   log likelihood = -7922.9978  
Iteration 4:   log likelihood = -7922.9978  

Generalized linear models                         Number of obs   =    100,118
Optimization     : ML                             Residual df     =    100,088
                                                  Scale parameter =          1
Deviance         =  15845.99553                   (1/df) Deviance =   .1583206
Pearson          =  100104.3794                   (1/df) Pearson  =   1.000164

Variance function: V(u) = u*(1-u)                 [Bernoulli]
Link function    : g(u) = ln(u/(1-u))             [Logit]

                                                  AIC             =   .1588725
Log likelihood   = -7922.997763                   BIC             =   -1136578

------------------------------------------------------------------------------
             |                 OIM
     risk_28 | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        sgtf |
        VOC  |    .972403   .0500393    -0.54   0.587     .8791115    1.075595
             |
        male |
          M  |   1.071121   .0551209     1.34   0.182     .9683559    1.184792
             |
         imd |
          2  |   1.008472   .0732877     0.12   0.908     .8745918    1.162847
          3  |   .7920787   .0617196    -2.99   0.003      .679895    .9227728
          4  |   .9891921   .0720846    -0.15   0.881     .8575347    1.141063
5 most de..  |    1.00033   .0922692     0.00   0.997     .8348907    1.198553
             |
        eth2 |
      Other  |   .9576981   .0574951    -0.72   0.472     .8513871    1.077284
household_~e |   .9699874   .0240724    -1.23   0.219     .9239354    1.018335
             |
    home_bin |
  Care home  |   1.077788   .0752506     1.07   0.283     .9399459    1.235844
             |
      region |
     London  |   1.004059   .0952493     0.04   0.966     .8337019    1.209227
 North East  |   1.034778    .112654     0.31   0.754     .8359468    1.280901
 North West  |    .966384   .1069134    -0.31   0.757     .7779994    1.200384
 South East  |   1.081912   .1160664     0.73   0.463     .8767506    1.335082
 South West  |   .9846282   .1084348    -0.14   0.888     .7934716    1.221837
West Midl..  |   .9762715   .1078474    -0.22   0.828     .7862118    1.212277
Yorkshire..  |   1.036765   .1128755     0.33   0.740     .8375445    1.283374
             |
rural_urban5 |
Urban min..  |   .8807607   .1029168    -1.09   0.277      .700479    1.107441
Urban cit..  |   .9836315   .0963337    -0.17   0.866     .8118363    1.191781
Rural tow..  |   .9470114   .0932481    -0.55   0.580     .7808024    1.148601
Rural vil..  |   .9646055   .0862695    -0.40   0.687     .8095105    1.149415
             |
  start_week |
23Nov-29Nov  |   1.222373   .1172103     2.09   0.036     1.012941    1.475106
30Nov-06Dec  |   1.114405   .1099666     1.10   0.272     .9184356    1.352189
07Dec-13Dec  |   1.100884   .1096458     0.97   0.335     .9056567    1.338195
14Dec-20Dec  |   1.173754   .1173062     1.60   0.109     .9649549    1.427733
21Dec-27Dec  |   1.135323   .1158598     1.24   0.214     .9295103    1.386707
28Dec-04Jan  |   1.173826   .1165669     1.61   0.107     .9662173    1.426042
             |
        age1 |   .9992044   .0053591    -0.15   0.882     .9887558    1.009764
        age2 |   1.003403   .0174819     0.20   0.845     .9697178    1.038259
        age3 |   .9923799   .0488101    -0.16   0.876     .9011803    1.092809
       _cons |   .0148156   .0046696   -13.36   0.000      .007988    .0274791
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.

. 
. 
. 
. *********************************************************************
. /* Demographically adjusted OR - age grouped, cat hh size                  */
. /* Not adjusting for comorbidities, obesity, or smoking status     */
. *********************************************************************
. 
. glm risk_28 i.sgtf i.male ib1.imd ib1.eth2 ib1.hh_total_cat i.home_bin ///
>                         i.region ib1.rural_urban5 ib1.start_week ib2.agegroup
> A ///
>                         if eth2 != 6 ///
>                         , family(bin) link(logit) eform

Iteration 0:   log likelihood = -12364.269  
Iteration 1:   log likelihood = -7731.5468  
Iteration 2:   log likelihood = -7715.2865  
Iteration 3:   log likelihood =  -7715.262  
Iteration 4:   log likelihood = -7715.2619  

Generalized linear models                         Number of obs   =     97,797
Optimization     : ML                             Residual df     =     97,766
                                                  Scale parameter =          1
Deviance         =  15430.52387                   (1/df) Deviance =   .1578312
Pearson          =  97823.58326                   (1/df) Pearson  =   1.000589

Variance function: V(u) = u*(1-u)                 [Bernoulli]
Link function    : g(u) = ln(u/(1-u))             [Logit]

                                                  AIC             =   .1584151
Log likelihood   = -7715.261937                   BIC             =   -1107964

------------------------------------------------------------------------------
             |                 OIM
     risk_28 | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        sgtf |
        VOC  |   .9731641   .0507608    -0.52   0.602     .8785912    1.077917
             |
        male |
          M  |   1.073634   .0560035     1.36   0.173     .9692934    1.189206
             |
         imd |
          2  |   1.015487   .0749657     0.21   0.835     .8786922    1.173579
          3  |   .8117149   .0638974    -2.65   0.008     .6956612    .9471294
          4  |   .9928138   .0735725    -0.10   0.922     .8585972    1.148011
5 most de..  |   1.024363   .0953715     0.26   0.796     .8535015    1.229429
             |
        eth2 |
      Other  |   .9644105   .0585817    -0.60   0.551      .856164    1.086343
             |
hh_total_cat |
        3-5  |   .9564977   .0499063    -0.85   0.394     .8635183    1.059489
       6-10  |   .4754581   .4776399    -0.74   0.459      .066375    3.405805
             |
    home_bin |
  Care home  |   1.070038   .0758941     0.95   0.340      .931165    1.229623
             |
      region |
     London  |   1.012494   .0973515     0.13   0.897     .8385895    1.222463
 North East  |   1.047835   .1154427     0.42   0.671     .8443327    1.300385
 North West  |   .9700271   .1087943    -0.27   0.786     .7786039    1.208513
 South East  |   1.072375   .1170148     0.64   0.522     .8658962     1.32809
 South West  |   .9778353   .1094974    -0.20   0.841     .7851428    1.217819
West Midl..  |   .9755646   .1094213    -0.22   0.825     .7830392    1.215426
Yorkshire..  |   1.040264   .1147748     0.36   0.721     .8379697    1.291393
             |
rural_urban5 |
Urban min..  |   .8757438   .1037413    -1.12   0.263     .6942934    1.104615
Urban cit..  |   .9888568   .0980387    -0.11   0.910     .8142212    1.200949
Rural tow..  |   .9532861   .0949771    -0.48   0.631     .7841822    1.158856
Rural vil..  |   .9589631   .0869269    -0.46   0.644     .8028663    1.145409
             |
  start_week |
23Nov-29Nov  |    1.23369   .1199722     2.16   0.031     1.019599    1.492734
30Nov-06Dec  |   1.114957   .1117628     1.09   0.278     .9160811    1.357007
07Dec-13Dec  |   1.095205   .1109601     0.90   0.369     .8979587    1.335778
14Dec-20Dec  |   1.191213   .1205855     1.73   0.084     .9768393    1.452633
21Dec-27Dec  |   1.160626    .119704     1.44   0.149     .9482037    1.420637
28Dec-04Jan  |   1.170866   .1182606     1.56   0.118       .96058    1.427187
             |
   agegroupA |
      0-<65  |   1.106692   .1014385     1.11   0.269     .9247119    1.324486
     75-<85  |   1.137646   .1562565     0.94   0.348     .8691489    1.489088
        85+  |   1.446374   .2475372     2.16   0.031     1.034197    2.022824
             |
       _cons |   .0131253   .0021858   -26.02   0.000     .0094702    .0181911
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.

. 
. 
. 
. ***********************************************************
. /* Fully adjusted OR - age as spline, continuous hh size */
. ***********************************************************
. 
. glm risk_28 i.sgtf i.male ib1.imd ib1.eth2 ib1.smoke_nomiss2 ib1.obese4cat ho
> usehold_size ///
>                         i.region ib1.rural_urban5 ib0.comorb_cat ib1.start_we
> ek age1 age2 age3 i.home_bin ///
>                         if eth2 != 6 ///
>                         , family(bin) link(logit) eform

Iteration 0:   log likelihood = -12672.618  
Iteration 1:   log likelihood = -7937.3393  
Iteration 2:   log likelihood = -7920.8372  
Iteration 3:   log likelihood = -7920.8203  
Iteration 4:   log likelihood = -7920.8203  

Generalized linear models                         Number of obs   =    100,118
Optimization     : ML                             Residual df     =    100,082
                                                  Scale parameter =          1
Deviance         =  15841.64054                   (1/df) Deviance =   .1582866
Pearson          =  100117.5707                   (1/df) Pearson  =   1.000355

Variance function: V(u) = u*(1-u)                 [Bernoulli]
Link function    : g(u) = ln(u/(1-u))             [Logit]

                                                  AIC             =   .1589488
Log likelihood   =  -7920.82027                   BIC             =   -1136513

------------------------------------------------------------------------------
             |                 OIM
     risk_28 | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        sgtf |
        VOC  |   .9724062   .0500432    -0.54   0.587     .8791077    1.075606
             |
        male |
          M  |   1.071049   .0551216     1.33   0.182      .968283    1.184722
             |
         imd |
          2  |   1.009076   .0733361     0.12   0.901      .875108    1.163553
          3  |   .7921799   .0617294    -2.99   0.003     .6799786    .9228953
          4  |   .9896421   .0721205    -0.14   0.886     .8579195    1.141589
5 most de..  |   1.000911   .0923259     0.01   0.992     .8353701    1.199256
             |
        eth2 |
      Other  |   .9582352   .0575311    -0.71   0.477      .851858    1.077896
             |
smoke_nomi~2 |
     Former  |   .9824911   .0729822    -0.24   0.812      .849374    1.136471
             |
   obese4cat |
Obese I ..)  |   1.078119   .0775314     1.05   0.296     .9363832    1.241308
Obese II..)  |   1.029903   .0750274     0.40   0.686     .8928679     1.18797
Obese II..)  |   1.035651   .0696272     0.52   0.602     .9077931    1.181517
             |
household_~e |   .9701737   .0240826    -1.22   0.223     .9241025    1.018542
             |
      region |
     London  |   1.003372   .0951892     0.04   0.972     .8331225    1.208411
 North East  |   1.034569   .1126383     0.31   0.755     .8357668    1.280659
 North West  |   .9664188   .1069205    -0.31   0.758     .7780223    1.200435
 South East  |   1.081664   .1160434     0.73   0.464     .8765437    1.334785
 South West  |   .9841083   .1083822    -0.15   0.884     .7930453    1.221203
West Midl..  |    .976518    .107879    -0.22   0.830     .7864034    1.212593
Yorkshire..  |   1.036615    .112864     0.33   0.741     .8374154      1.2832
             |
rural_urban5 |
Urban min..  |    .880176   .1028526    -1.09   0.275     .7000076    1.106716
Urban cit..  |    .983543   .0963296    -0.17   0.865     .8117558    1.191684
Rural tow..  |   .9472725   .0932769    -0.55   0.582     .7810126    1.148925
Rural vil..  |   .9651775   .0863258    -0.40   0.692      .809982    1.150109
             |
  comorb_cat |
1 comorbi..  |   .8375995   .0914878    -1.62   0.105     .6761809    1.037552
2+ comorb..  |   .8365601    .082443    -1.81   0.070     .6896222    1.014806
             |
  start_week |
23Nov-29Nov  |   1.221915   .1171741     2.09   0.037     1.012549    1.474572
30Nov-06Dec  |   1.115466   .1100757     1.11   0.268     .9193033    1.353487
07Dec-13Dec  |    1.10084   .1096493     0.96   0.335     .9056073     1.33816
14Dec-20Dec  |   1.174574   .1173977     1.61   0.107      .965614    1.428754
21Dec-27Dec  |   1.136356   .1159748     1.25   0.210     .9303409    1.387991
28Dec-04Jan  |     1.1734   .1165323     1.61   0.107     .9658546    1.425543
             |
        age1 |   .9992424   .0053598    -0.14   0.888     .9887925    1.009803
        age2 |   1.003306   .0174809     0.19   0.850     .9696223     1.03816
        age3 |   .9926168   .0488213    -0.15   0.880     .9013962    1.093069
             |
    home_bin |
  Care home  |    1.07795   .0752679     1.07   0.282     .9400776    1.236044
       _cons |   .0170703   .0056274   -12.35   0.000     .0089461    .0325724
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.

. 
. 
. 
. **************************************************
. /* Fully adjusted OR - age grouped, cat hh size */
. **************************************************
. 
. glm risk_28 i.sgtf ib2.agegroupA i.male ib1.imd ib1.eth2 ib1.smoke_nomiss2 ib
> 1.obese4cat ///
>                         ib1.hh_total_cat i.region ib1.rural_urban5 ib0.comorb
> _cat ib1.start_week i.home_bin ///
>                         if eth2 != 6 ///
>                         , family(bin) link(logit) eform

Iteration 0:   log likelihood = -12363.964  
Iteration 1:   log likelihood = -7729.9636  
Iteration 2:   log likelihood = -7712.8152  
Iteration 3:   log likelihood = -7712.7921  
Iteration 4:   log likelihood = -7712.7921  

Generalized linear models                         Number of obs   =     97,797
Optimization     : ML                             Residual df     =     97,760
                                                  Scale parameter =          1
Deviance         =  15425.58416                   (1/df) Deviance =   .1577903
Pearson          =  97831.89184                   (1/df) Pearson  =   1.000735

Variance function: V(u) = u*(1-u)                 [Bernoulli]
Link function    : g(u) = ln(u/(1-u))             [Logit]

                                                  AIC             =   .1584873
Log likelihood   = -7712.792081                   BIC             =   -1107900

------------------------------------------------------------------------------
             |                 OIM
     risk_28 | Odds Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        sgtf |
        VOC  |    .973174   .0507656    -0.52   0.602     .8785927    1.077937
             |
   agegroupA |
      0-<65  |   1.105033   .1012945     1.09   0.276     .9233122    1.322519
     75-<85  |   1.135993   .1560403     0.93   0.353      .867869    1.486951
        85+  |   1.442773   .2469418     2.14   0.032     1.031592    2.017844
             |
        male |
          M  |   1.073541    .056004     1.36   0.174     .9692005    1.189115
             |
         imd |
          2  |   1.016121   .0750175     0.22   0.829     .8792316    1.174322
          3  |   .8118502   .0639105    -2.65   0.008      .695773    .9472929
          4  |   .9931844   .0736035    -0.09   0.926     .8589117    1.148448
5 most de..  |   1.024987   .0954334     0.27   0.791     .8540152    1.230187
             |
        eth2 |
      Other  |   .9650837   .0586267    -0.59   0.559     .8567544     1.08711
             |
smoke_nomi~2 |
     Former  |   .9885703   .0743291    -0.15   0.878     .8531139    1.145534
             |
   obese4cat |
Obese I ..)  |   1.073969   .0784184     0.98   0.328      .930763    1.239208
Obese II..)  |   1.037142   .0764598     0.49   0.621     .8976069    1.198368
Obese II..)  |   1.039768    .070842     0.57   0.567     .9097918    1.188313
             |
hh_total_cat |
        3-5  |   .9569096   .0499301    -0.84   0.399     .8638862     1.05995
       6-10  |   .4731778   .4753605    -0.74   0.456     .0660536    3.389631
             |
      region |
     London  |   1.011638   .0972746     0.12   0.904     .8378712    1.221442
 North East  |   1.047686    .115435     0.42   0.672     .8441993    1.300221
 North West  |   .9704385   .1088445    -0.27   0.789     .7789276    1.209035
 South East  |   1.072172   .1169965     0.64   0.523     .8657263    1.327848
 South West  |   .9773773   .1094512    -0.20   0.838     .7847671    1.217261
West Midl..  |   .9756929   .1094402    -0.22   0.826     .7831351    1.215597
Yorkshire..  |   1.039904   .1147404     0.35   0.723     .8376717     1.29096
             |
rural_urban5 |
Urban min..  |   .8752367   .1036852    -1.12   0.261     .6938852    1.103986
Urban cit..  |   .9890683   .0980642    -0.11   0.912     .8143879    1.201216
Rural tow..  |   .9538749   .0950394    -0.47   0.636     .7846608    1.159581
Rural vil..  |   .9597758   .0870064    -0.45   0.651     .8035371    1.146393
             |
  comorb_cat |
1 comorbi..  |   .8323873   .0914118    -1.67   0.095     .6711931    1.032294
2+ comorb..  |   .8183225   .0811031    -2.02   0.043     .6738493    .9937708
             |
  start_week |
23Nov-29Nov  |   1.233122   .1199253     2.15   0.031     1.019116    1.492067
30Nov-06Dec  |   1.116092   .1118813     1.10   0.273      .917006      1.3584
07Dec-13Dec  |   1.095122   .1109602     0.90   0.370     .8978768    1.335697
14Dec-20Dec  |    1.19178   .1206528     1.73   0.083      .977288    1.453348
21Dec-27Dec  |   1.161458   .1197992     1.45   0.147     .9488679    1.421677
28Dec-04Jan  |   1.170551   .1182369     1.56   0.119     .9603088    1.426822
             |
    home_bin |
  Care home  |   1.070126   .0759067     0.96   0.339     .9312302    1.229738
       _cons |   .0153403   .0029553   -21.68   0.000      .010516    .0223778
------------------------------------------------------------------------------
Note: _cons estimates baseline odds.

. 
. est store fully

. 
. * Adjusted absolute risks
. margins comorb_cat#male#agegroupA if sgtf==0, post asobserved

Predictive margins                              Number of obs     =     48,695
Model VCE    : OIM

Expression   : Predicted mean risk_28, predict()

------------------------------------------------------------------------------
             |            Delta-method
             |     Margin   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
  comorb_cat#|
        male#|
   agegroupA |
No comorb.. #|
          F #|
      0-<65  |   .0179063   .0017929     9.99   0.000     .0143923    .0214203
No comorb.. #|
          F #|
     65-<75  |   .0162324    .002099     7.73   0.000     .0121184    .0203463
No comorb.. #|
          F #|
     75-<85  |   .0183986   .0026073     7.06   0.000     .0132884    .0235089
No comorb.. #|
          F #|
        85+  |   .0232501   .0040181     5.79   0.000     .0153747    .0311254
No comorb.. #|
          M #|
      0-<65  |   .0191975   .0019125    10.04   0.000     .0154491    .0229459
No comorb.. #|
          M #|
     65-<75  |    .017405   .0022431     7.76   0.000     .0130085    .0218015
No comorb.. #|
          M #|
     75-<85  |   .0197246   .0027837     7.09   0.000     .0142687    .0251805
No comorb.. #|
          M #|
        85+  |   .0249167   .0042891     5.81   0.000     .0165103    .0333231
1 comorbi.. #|
          F #|
      0-<65  |   .0149505   .0010088    14.82   0.000     .0129734    .0169276
1 comorbi.. #|
          F #|
     65-<75  |    .013549   .0014313     9.47   0.000     .0107437    .0163543
1 comorbi.. #|
          F #|
     75-<85  |   .0153629   .0018659     8.23   0.000     .0117058    .0190199
1 comorbi.. #|
          F #|
        85+  |   .0194299   .0030577     6.35   0.000     .0134369    .0254229
1 comorbi.. #|
          M #|
      0-<65  |   .0160321   .0010754    14.91   0.000     .0139244    .0181398
1 comorbi.. #|
          M #|
     65-<75  |   .0145307   .0015307     9.49   0.000     .0115306    .0175309
1 comorbi.. #|
          M #|
     75-<85  |   .0164738   .0019931     8.27   0.000     .0125675    .0203801
1 comorbi.. #|
          M #|
        85+  |   .0208286   .0032662     6.38   0.000     .0144269    .0272302
2+ comorb.. #|
          F #|
      0-<65  |   .0147017   .0007209    20.39   0.000     .0132886    .0161147
2+ comorb.. #|
          F #|
     65-<75  |   .0133232   .0012602    10.57   0.000     .0108533    .0157931
2+ comorb.. #|
          F #|
     75-<85  |   .0151073   .0016937     8.92   0.000     .0117876    .0184269
2+ comorb.. #|
          F #|
        85+  |   .0191079   .0028641     6.67   0.000     .0134944    .0247214
2+ comorb.. #|
          M #|
      0-<65  |   .0157656   .0007672    20.55   0.000     .0142619    .0172692
2+ comorb.. #|
          M #|
     65-<75  |   .0142888   .0013481    10.60   0.000     .0116466    .0169309
2+ comorb.. #|
          M #|
     75-<85  |      .0162   .0018092     8.95   0.000      .012654     .019746
2+ comorb.. #|
          M #|
        85+  |   .0204839   .0030597     6.69   0.000     .0144871    .0264808
------------------------------------------------------------------------------

. 
. * Save risk estimates
. matrix est = e(b)

. matrix inv_est = est'

. svmat inv_est

. 
. * Save SE estimates
. matrix var = e(V)

. matrix diag_var = vecdiag(var)

. matrix inv_var = diag_var'

. svmat inv_var

. gen sq_var = sqrt(inv_var1)
(148,756 missing values generated)

. 
. noi disp "CHECK MARGINS ARE CORRECTLY CALCULATED TO MATCH ABOVE"
CHECK MARGINS ARE CORRECTLY CALCULATED TO MATCH ABOVE

. list inv_est1 sq_var in 1/24

     +---------------------+
     | inv_est1     sq_var |
     |---------------------|
  1. | .0179063   .0017929 |
  2. | .0162324    .002099 |
  3. | .0183986   .0026073 |
  4. | .0232501   .0040181 |
  5. | .0191975   .0019125 |
     |---------------------|
  6. |  .017405   .0022431 |
  7. | .0197246   .0027837 |
  8. | .0249167   .0042891 |
  9. | .0149505   .0010088 |
 10. |  .013549   .0014313 |
     |---------------------|
 11. | .0153629   .0018659 |
 12. | .0194299   .0030577 |
 13. | .0160321   .0010754 |
 14. | .0145307   .0015307 |
 15. | .0164738   .0019931 |
     |---------------------|
 16. | .0208286   .0032662 |
 17. | .0147017   .0007209 |
 18. | .0133232   .0012602 |
 19. | .0151073   .0016937 |
 20. | .0191079   .0028641 |
     |---------------------|
 21. | .0157656   .0007672 |
 22. | .0142888   .0013481 |
 23. |    .0162   .0018092 |
 24. | .0204839   .0030597 |
     +---------------------+

. 
. * Re-Calculate CI
. gen risk0 = inv_est1*100
(148,756 missing values generated)

. gen lb0 = (inv_est1 - invnormal(0.975)*sq_var)*100
(148,756 missing values generated)

. gen ub0 = (inv_est1 + invnormal(0.975)*sq_var)*100
(148,756 missing values generated)

. 
. order lb ub, after(risk0)

. 
. 
. est restore fully
(results fully are active now)

. 
. * Adjusted absolute risks
. margins comorb_cat#male#agegroupA if sgtf==1, post asobserved

Predictive margins                              Number of obs     =     49,102
Model VCE    : OIM

Expression   : Predicted mean risk_28, predict()

------------------------------------------------------------------------------
             |            Delta-method
             |     Margin   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
  comorb_cat#|
        male#|
   agegroupA |
No comorb.. #|
          F #|
      0-<65  |   .0174291   .0017464     9.98   0.000     .0140062    .0208519
No comorb.. #|
          F #|
     65-<75  |    .015799   .0020438     7.73   0.000     .0117932    .0198048
No comorb.. #|
          F #|
     75-<85  |   .0179085   .0025385     7.05   0.000     .0129331    .0228839
No comorb.. #|
          F #|
        85+  |   .0226337    .003914     5.78   0.000     .0149624     .030305
No comorb.. #|
          M #|
      0-<65  |   .0186865   .0018637    10.03   0.000     .0150337    .0223394
No comorb.. #|
          M #|
     65-<75  |   .0169409   .0021848     7.75   0.000     .0126587    .0212231
No comorb.. #|
          M #|
     75-<85  |   .0191999   .0027109     7.08   0.000     .0138866    .0245131
No comorb.. #|
          M #|
        85+  |   .0242572   .0041789     5.80   0.000     .0160668    .0324477
1 comorbi.. #|
          F #|
      0-<65  |   .0145509    .000987    14.74   0.000     .0126165    .0164853
1 comorbi.. #|
          F #|
     65-<75  |   .0131863   .0013959     9.45   0.000     .0104504    .0159223
1 comorbi.. #|
          F #|
     75-<85  |   .0149524   .0018186     8.22   0.000      .011388    .0185167
1 comorbi.. #|
          F #|
        85+  |   .0189128   .0029802     6.35   0.000     .0130717    .0247539
1 comorbi.. #|
          M #|
      0-<65  |    .015604   .0010532    14.82   0.000     .0135399    .0176681
1 comorbi.. #|
          M #|
     65-<75  |   .0141421   .0014935     9.47   0.000     .0112149    .0170693
1 comorbi.. #|
          M #|
     75-<85  |   .0160341   .0019432     8.25   0.000     .0122255    .0198426
1 comorbi.. #|
          M #|
        85+  |   .0202751   .0031842     6.37   0.000     .0140342     .026516
2+ comorb.. #|
          F #|
      0-<65  |   .0143086   .0007044    20.31   0.000     .0129279    .0156892
2+ comorb.. #|
          F #|
     65-<75  |   .0129664   .0012277    10.56   0.000     .0105603    .0153726
2+ comorb.. #|
          F #|
     75-<85  |   .0147035   .0016493     8.92   0.000      .011471     .017936
2+ comorb.. #|
          F #|
        85+  |   .0185993     .00279     6.67   0.000      .013131    .0240675
2+ comorb.. #|
          M #|
      0-<65  |   .0153445   .0007509    20.43   0.000     .0138727    .0168162
2+ comorb.. #|
          M #|
     65-<75  |   .0139066   .0013139    10.58   0.000     .0113313    .0164818
2+ comorb.. #|
          M #|
     75-<85  |   .0157675   .0017624     8.95   0.000     .0123133    .0192216
2+ comorb.. #|
          M #|
        85+  |   .0199394   .0029813     6.69   0.000     .0140963    .0257826
------------------------------------------------------------------------------

. 
. * Save risk estimates
. matrix est1 = e(b)

. matrix inv_estx = est1'

. svmat inv_estx

. 
. * Save SE estimates
. matrix var1 = e(V)

. matrix diag_var1 = vecdiag(var1)

. matrix inv_varx = diag_var1'

. svmat inv_varx

. gen sq_varx = sqrt(inv_varx1)
(148,756 missing values generated)

. 
. noi disp "CHECK MARGINS ARE CORRECTLY CALCULATED TO MATCH ABOVE"
CHECK MARGINS ARE CORRECTLY CALCULATED TO MATCH ABOVE

. list inv_estx1 sq_varx in 1/24

     +---------------------+
     | inv_e~x1    sq_varx |
     |---------------------|
  1. | .0174291   .0017464 |
  2. |  .015799   .0020438 |
  3. | .0179085   .0025385 |
  4. | .0226337    .003914 |
  5. | .0186865   .0018637 |
     |---------------------|
  6. | .0169409   .0021848 |
  7. | .0191999   .0027109 |
  8. | .0242572   .0041789 |
  9. | .0145509    .000987 |
 10. | .0131863   .0013959 |
     |---------------------|
 11. | .0149524   .0018186 |
 12. | .0189128   .0029802 |
 13. |  .015604   .0010532 |
 14. | .0141421   .0014935 |
 15. | .0160341   .0019432 |
     |---------------------|
 16. | .0202751   .0031842 |
 17. | .0143086   .0007044 |
 18. | .0129664   .0012277 |
 19. | .0147035   .0016493 |
 20. | .0185993     .00279 |
     |---------------------|
 21. | .0153445   .0007509 |
 22. | .0139066   .0013139 |
 23. | .0157675   .0017624 |
 24. | .0199394   .0029813 |
     +---------------------+

. 
. * Re-Calculate CI
. gen risk1 = inv_estx1*100
(148,756 missing values generated)

. gen lb1 = (inv_estx1 - invnormal(0.975)*sq_varx)*100
(148,756 missing values generated)

. gen ub1 = (inv_estx1 + invnormal(0.975)*sq_varx)*100
(148,756 missing values generated)

. 
. order lb1 ub1, after(risk1)

. 
. 
. * Adjusted risk difference
. est restore fully
(results fully are active now)

. 
. margins comorb_cat#male#agegroupA, dydx(sgtf) post asobserved

Average marginal effects                        Number of obs     =     97,797
Model VCE    : OIM

Expression   : Predicted mean risk_28, predict()
dy/dx w.r.t. : 1.sgtf

------------------------------------------------------------------------------
             |            Delta-method
             |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
0.sgtf       |  (base outcome)
-------------+----------------------------------------------------------------
1.sgtf       |
  comorb_cat#|
        male#|
   agegroupA |
No comorb.. #|
          F #|
      0-<65  |  -.0004718   .0009062    -0.52   0.603    -.0022479    .0013043
No comorb.. #|
          F #|
     65-<75  |  -.0004284   .0008236    -0.52   0.603    -.0020426    .0011858
No comorb.. #|
          F #|
     75-<85  |  -.0004845   .0009319    -0.52   0.603    -.0023111    .0013421
No comorb.. #|
          F #|
        85+  |  -.0006093   .0011733    -0.52   0.604     -.002909    .0016904
No comorb.. #|
          M #|
      0-<65  |  -.0005051   .0009702    -0.52   0.603    -.0024068    .0013965
No comorb.. #|
          M #|
     65-<75  |  -.0004588    .000882    -0.52   0.603    -.0021875    .0012699
No comorb.. #|
          M #|
     75-<85  |  -.0005187   .0009977    -0.52   0.603    -.0024742    .0014367
No comorb.. #|
          M #|
        85+  |  -.0006519   .0012552    -0.52   0.604     -.003112    .0018083
1 comorbi.. #|
          F #|
      0-<65  |  -.0003951   .0007582    -0.52   0.602    -.0018811    .0010909
1 comorbi.. #|
          F #|
     65-<75  |  -.0003585   .0006887    -0.52   0.603    -.0017083    .0009912
1 comorbi.. #|
          F #|
     75-<85  |  -.0004058   .0007799    -0.52   0.603    -.0019343    .0011227
1 comorbi.. #|
          F #|
        85+  |  -.0005111   .0009835    -0.52   0.603    -.0024388    .0014165
1 comorbi.. #|
          M #|
      0-<65  |  -.0004232   .0008121    -0.52   0.602    -.0020149    .0011685
1 comorbi.. #|
          M #|
     65-<75  |  -.0003841   .0007378    -0.52   0.603    -.0018302    .0010619
1 comorbi.. #|
          M #|
     75-<85  |  -.0004347   .0008353    -0.52   0.603    -.0020718    .0012024
1 comorbi.. #|
          M #|
        85+  |  -.0005472   .0010528    -0.52   0.603    -.0026105    .0015162
2+ comorb.. #|
          F #|
      0-<65  |  -.0003886   .0007456    -0.52   0.602      -.00185    .0010728
2+ comorb.. #|
          F #|
     65-<75  |  -.0003526   .0006772    -0.52   0.603      -.00168    .0009747
2+ comorb.. #|
          F #|
     75-<85  |  -.0003992    .000767    -0.52   0.603    -.0019024    .0011041
2+ comorb.. #|
          F #|
        85+  |  -.0005028   .0009674    -0.52   0.603    -.0023988    .0013932
2+ comorb.. #|
          M #|
      0-<65  |  -.0004163   .0007987    -0.52   0.602    -.0019817    .0011491
2+ comorb.. #|
          M #|
     65-<75  |  -.0003778   .0007256    -0.52   0.603       -.0018    .0010443
2+ comorb.. #|
          M #|
     75-<85  |  -.0004276   .0008215    -0.52   0.603    -.0020377    .0011825
2+ comorb.. #|
          M #|
        85+  |  -.0005383   .0010355    -0.52   0.603    -.0025679    .0014913
------------------------------------------------------------------------------
Note: dy/dx for factor levels is the discrete change from the base level.

. 
. * Save risk estimates
. matrix diff = e(b)

. matrix diff = diff[1, 25..48]

. matrix inv_diff = diff'

. svmat inv_diff

. 
. * Save SE estimates
. matrix dvar = e(V)

. matrix dvar = dvar[1, 25..48]

. matrix diag_dvar = vecdiag(dvar)
conformability error
r(503);

end of do-file
r(503);
